test-py2.7:
  stage: test
  image: python:2.7
  script:
  - apt-get update -qy
  - pip install -r requirements.txt
  - export PYTHONPATH=/builds/cbeauchesne/CampBot:$PYTHONPATH
  - pytest --cov campbot --cov-report=html --cov-report=term
  - mv htmlcov/ htmlcov-2.7/
  artifacts:
    paths:
      - htmlcov-2.7
      
test-py3.4:
  stage: test
  image: python:3.4
  script:
  - apt-get update -qy
  - pip install -r requirements.txt
  - export PYTHONPATH=/builds/cbeauchesne/CampBot:$PYTHONPATH
  - pytest --cov campbot --cov-report=term
      
test-py3.5:
  stage: test
  image: python:3.5
  script:
  - apt-get update -qy
  - pip install -r requirements.txt
  - export PYTHONPATH=/builds/cbeauchesne/CampBot:$PYTHONPATH
  - pytest --cov campbot --cov-report=html --cov-report=term
  - mv htmlcov/ htmlcov-3.5/
  artifacts:
    paths:
      - htmlcov-3.5
      
test-py3.6:
  stage: test
  image: python:3.6
  script:
  - apt-get update -qy
  - pip install -r requirements.txt
  - export PYTHONPATH=/builds/cbeauchesne/CampBot:$PYTHONPATH
  - pytest --cov campbot --cov-report=term
      
pages:
  stage: deploy
  dependencies:
    - test-py2.7
    - test-py3.5
  script:
  - mkdir public/
  - mv htmlcov-2.7/ public/htmlcov-2.7/
  - mv htmlcov-3.5/ public/htmlcov-3.5/
  only:
  - master
  artifacts:
    paths:
      - public